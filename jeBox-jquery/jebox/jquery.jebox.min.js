/**
 @Name : jeBox v1.2 弹层组件
 @Author: chen guojun
 @Date: 2016-10-12
 @QQ群：516754269
 @官网：http://www.jayui.com/jebox/ 或 https://github.com/singod/jeBox
 */
!function(a,b){"function"==typeof define&&define.amd?define(["$"],b):"object"==typeof exports?module.exports=b():a.jeBox=b(window.jQuery||$)}(this,function(a){function h(a){var c=this;c.config=a,c.index=""==c.config.cell||void 0==c.config.cell?++b.index:c.config.cell,c.initView()}function j(a,b,c,d,e){b.length>0&&b.parent()?b.after(a):c.length>0&&c.parent()?c.before(a):d.length>0&&d.append(a),a.css("display",e),this.backSitu=null}var f,g,i,b={},c={},d=/\px|em/g,e=-[1]?9:parseInt(navigator.appVersion.split(";")[1].replace(/MSIE|[ ]/g,""));return b.index=Math.floor(9e3*Math.random()),c.isBool=function(a){return void 0==a||1==a?!0:!1},c.endfun={},f=["jeBox",".jeBox-wrap",".jeBox-header",".jeBox-content",".jeBox-footer",".jeBox-close",".jeBox-maxbtn"],g={cell:"",title:"提示信息"},i=h.prototype,i.initView=function(){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,b=this,d=b.config;c.scrollbar=d.scrollbar||!1,""!=d.cell&&a("#"+f[0]+b.index).size()>0||(h=function(){var k,l,a=0,c=d.button||[],e=c.length,f=void 0!=d.yesBtn&&""!=d.yesBtn,g=void 0!=d.noBtn&&""!=d.noBtn,h={name:d.yesBtn},i={name:d.noBtn},j=[];return f&&g?k=0!=e?[h,i,c]:[h,i]:f?k=0!=e?[h,c]:[h]:g&&(a=1,k=0!=e?[i,c]:[i]),b.button=k,l=k?function(){for(;a<k.length;a++){var b=1==k[a].disabled?"disabled":"";j.push('<button type="button" class="jeBox-btn'+a+'" jebtn="'+a+'" '+b+">"+k[a].name+"</button>")}return j.reverse().join("")}():"",'<div class="jeBox-footer" style="text-align:'+(d.btnAlign||"right")+'">'+l+"</div>"}(),i=d.padding||"5px",j=d.skinCell||"jeBox-anim",k='<span class="jeBox-headbtn"><a href="javascript:;" class="jeBox-maxbtn" title="最大化"></a><a href="javascript:;" class="jeBox-close" title="&#20851;&#38381;"></a></span><div class="jeBox-header"></div><div class="jeBox-content" style="padding:'+(""!=i?i:0)+';"></div>'+h,l=function(b){var c=0;return b.each(function(){c=Math.max(c,a(this).css("z-index"))}),c},m=d.zIndex||9999,n=a(f[1]).size()>0?l(a(f[1]))+5:m+5,o=a(f[1]).size()>0?l(a(f[1]))+2:m,p=a("<div/>",{id:f[0]+b.index,"class":f[1].replace(/\./g,"")}),a("body").append(p.append(k)),p.attr("jeitem",b.index),p.css({position:c.isBool(d.fixed)?"fixed":"absolute","z-index":n}),parseInt(e)<9?p.addClass("jeBox-ies"):p.addClass(j),c.isBool(d.masklock)&&(q=a("<div/>",{id:"jemask"+b.index,"class":"jeBox-mask"}),r=d.maskColor||["#333",.5],a("body").append(q),q.css({left:0,top:0,"background-color":r[0],"z-index":o,opacity:r[1],filter:"alpha(opacity="+100*r[1]+")"})),s=a("#"+f[0]+b.index),t=0==d.title?"":d.title||g.title,u="object"==typeof t,v=t?u?t[0]:t:"",w=void 0===d.yesBtn&&void 0===d.noBtn&&void 0===d.button?!0:!1,s.find(f[2]).html(v).css({display:""!=v?"":"none",height:""!=v?"":"0px"}).css(u?t[1]:{}),s.find(f[4]).css({display:w?"none":"",height:w?"0px":""}),s.find(f[5]).css("display",c.isBool(d.closeBtn)?"":"none"),s.find(f[6]).css("display",d.maxBtn?"":"none"),!c.scrollbar&&a("body").css("overflow","hidden"),b.setContent(d),b.setSize(d,s),b.setPosition(d,s),b.btnCallback(d,s),c.isBool(d.isDrag)&&""!=v&&(x=s,y=s.find(f[2]),b.dragLayer(x,y,.4,c.isBool(d.shadow))),setTimeout(function(){d.success&&d.success(s,b.index)},5))},i.setContent=function(b){var l,d=this,e=a("#"+f[0]+d.index).find(f[3]),g=b.content,h=b.type||1,i=b.icon||0,j="object"==typeof g,k='<div class="jeBox-iconbox jeicon'+b.icon+'">'+g+"</div>";switch(h){case 1:"string"==typeof g?e.html(0!==b.icon?k:g):g[0]&&1===g[0].nodeType&&(a("#"+f[0]+d.index).attr("jenode",g.selector.toString()),c.Dispy=g.css("display"),c.Prev=g.prev(),c.Next=g.next(),c.Parent=g.parent(),"none"==g.css("display")&&g.css("display","block"),e.append(g));break;case 2:l=j?g:[g||"http://www.jayui.com/","auto"],e.html('<iframe scrolling="'+(l[1]||"auto")+'" allowtransparency="true" id="jeboxiframe'+d.index+'" name="'+d.index+'" onload="this.className=\'\';" frameborder="0" width="100%" height="100%" src="'+l[0]+'"></iframe>');break;case 3:e.html('<div class="jeBox-loadbox jeload'+i+'">'+g+"</div>")}return d},i.setSize=function(b,e){var h,i,j,k,l,m,y,z,A,B,g=this,n=e.find(f[3]),o=b.areaSize||["auto","auto"],p=function(a){return parseInt(n.css(a).replace(d,""))},q=a(window).width(),r=a(window).height(),s=c.conhead=e.find(f[2]).height(),t=c.confoot=e.find(f[4]).height(),u=p("padding-top")+p("padding-bottom"),v=p("padding-left")+p("padding-right"),w=p("margin-top")+p("margin-bottom"),x=p("margin-left")+p("margin-right");return a.isArray(o)&&(h=o[0],i=o[1],y=/^\d+%$/.test(h.toString())?parseInt(q*(h.toString().replace("%","")/100)):parseInt(h.toString().replace(d,"")),z=y>=q?q:y,A=/^\d+%$/.test(i.toString())?parseInt(r*(i.toString().replace("%","")/100)):parseInt(i.toString().replace(d,"")),B=A>=r?r:A,"number"===a.type(h)?(j=y,l=y-v-x):"auto"==h?(j=e.outerWidth(),l=e.outerWidth()-v-x):(j=z,l=z-v-x),"number"===a.type(i)?(k=A,m=A-u-w-s-t):"auto"==i?(k=e.outerHeight(),m=e.outerHeight()-u-w-s-t):(k=B,m=B-u-w-s-t)),b.maxBtn&&e.attr("area",[j,k,l,m]),e.css({width:j,height:k}).css(b.boxStyle||{}),e.find(f[3]).css({width:l,height:m}),g},i.setPosition=function(b,c){var e=this,i=b.offset||["auto","auto"],j=a.isArray(i),k=c.width(),l=c.height(),f=i[0],m=i[1],n=a(window).width(),o=a(window).height(),g=j&&/^\@/.test(f)?f.replace(/\@/g,""):"auto"==f?(o-l)/2:/^\d+%$/.test(f)?f:f.replace(d,""),h=j&&/^\@/.test(m)?m.replace(/\@/g,""):"auto"==m?(n-k)/2:/^\d+%$/.test(m)?m:m.replace(d,""),p=j&&(/^\@/.test(f)||/^\@/.test(m))?{right:g,bottom:h}:{top:g,left:h};return c.css(p),b.maxBtn&&c.attr("offset",[g,h]),e},i.btnCallback=function(d,e){function k(){var a=d.nofun&&d.nofun(g.index);a===!1||b.close(g.index)}var g=this,h=e.find(f[6]),i=d.time||0,j=d.offset||["auto","auto"];return 0>=i||setTimeout(function(){b.close(g.index)},1e3*i),c.isBool(d.closeBtn)&&e.find(f[5]).on("click",k),d.maxBtn&&h.bind("click",function(){h.hasClass("revert")?(h.removeClass("revert"),b.restore(g.index),a(this).attr("title","最大化")):(h.addClass("revert"),b.full(g.index),a(this).attr("title","还原"))}),g.button&&e.find(f[4]+" button").on("click",function(){var c=parseInt(a(this).attr("jebtn"));0===c&&(d.yesfun?d.yesfun(g.index,e):b.close(g.index)),g.button.length>1&&(1===c?k():c>1&&(g.button[c]["callback"]&&g.button[c]["callback"](g.index,e),g.button[c]["callback"]||b.close(g.index)))}),c.isBool(d.maskClose)&&a("#jemask"+g.index).on("click",function(){b.close(g.index)}),a(window).resize(function(){a.isArray(j)&&(/^\@/.test(j[0])||/^\@/.test(j[1]))&&e.css({top:"",left:""}),g.setPosition(d,e)}),d.endfun&&(c.endfun[g.index]=d.endfun),g},i.dragLayer=function(b,c,e,f){var i,g=this,h=!-[1];return c=c||b,i=tmpY=0,g.isMoveable=!1,c.css("cursor","move"),f?(g.isShadow=f?1==f||0==f?f:!1:!1,g.isShadow&&(g.opacity=e)):(g.opacity=100,g.isShadow=!1),c.on("mousedown",function(c){var e,f,j,k;return c=c||window.event,e=a("<div/>",{id:"jeBox-moves","class":"jeBox-moves"}),f=b.css("left"),j=b.css("top"),k=a("<div/>",{"class":"movescon"}),h&&1!=c.button||h&&0==c.button?!1:(g.isShadow&&(e.css({width:b.outerWidth()-4,height:b.outerHeight()-4,left:f,top:j,"z-index":parseInt(b.css("z-index"))+10}),a("body").append(e.append(k))),g.isMoveable=!0,i=c.pageX-f.replace(d,""),tmpY=c.pageY-j.replace(d,""),c.preventDefault&&(c.preventDefault(),c.stopPropagation()),a(document).on("mousemove",function(c){if(g.isMoveable){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var c=c||window.event,d=g.isShadow?e:b,f=c.pageX-i,h=c.pageY-tmpY,j=a(window).width()-b.outerWidth(),k=a(window).height()-b.outerHeight();0>=f&&(f=0),0>=h&&(h=0),f>=j&&(f=j),h>=k&&(h=k),d.css({top:h,left:f})}}).on("mouseup",function(){g.isMoveable&&(g.isMoveable=!1,i=tmpY=0,b.css({right:"",bottom:""}),g.isShadow&&(b.css({top:e.css("top"),left:e.css("left")}),a("#jeBox-moves").remove()),a(window).width()!=b.outerWidth()&&b.attr("offset",[b.css("top").replace(d,""),b.css("left").replace(d,"")]))}),void 0)}),g},b.open=function(a){var b=new h(a||{});return b.index},b.close=function(b){var d=a("#"+f[0]+b),e=a("#jemask"+b),g=d.attr("jenode");d&&(a(g).size()>0&&1===a(g)[0].nodeType&&j(a(g),c.Prev,c.Next,c.Parent,c.Dispy),d&&d.remove(),e&&e.remove(),"hidden"==a("body").css("overflow")&&a("body").css("overflow",""),"function"==typeof c.endfun[b]&&c.endfun[b](),delete c.endfun[b])},b.closeAll=function(){a(f[1]).each(function(a,c){b.close(c.attr("jeitem"))})},b.version="1.2",b.title=function(b,c){a("#"+f[0]+c).find(f[2]).html(b)},b.content=function(b,c){a("#"+f[0]+c).find(f[3]).html(b)},b.msg=function(c,d,e){var f=a.isFunction(d);return f&&(e=d),b.open(a.extend({title:!1,content:c,padding:"10px",skinCell:"jeBox-animMsg",time:3,masklock:!1,closeBtn:!1,end:e},!f&&function(){return d=d||{}}()))},b.alert=function(c,d,e){var f=a.isFunction(d);return f&&(e=d),b.open(a.extend({content:c,yesfun:e,yesBtn:"确定"},f?{}:d))},b.loading=function(c,d,e){return b.open(a.extend({title:!1,closeBtn:!1,type:3,skinCell:"jeBox-animLoad",masklock:!1,content:void 0==d?"":d,icon:c||1},e))},b.restore=function(b){var d=a("#"+f[0]+b),e=d.find(f[3]),g=d.attr("area").split(/,/g),h=d.attr("offset").split(/,/g);a("body").css("overflow",0==c.scrollbar?"hidden":""),d.css({width:g[0],height:g[1],top:h[0]+"px",left:h[1]+"px",right:"",bottom:""}),e.css({width:g[2],height:g[3]})},b.full=function(b){var c,d=a("#"+f[0]+b),e=d.find(f[3]);a("body").css("overflow","hidden"),clearTimeout(c),c=setTimeout(function(){d.find(f[6]).addClass("revert");var b="fixed"===d.css("position"),c=d.attr("offset").split(","),g=a(window).width(),h=a(window).height(),i=e.outerWidth(!0)-e.width(),j=e.outerHeight(!0)-e.height(),k=d.find(f[2]).outerHeight(!0),l=d.find(f[4]).outerHeight(!0);d.css({width:g,height:h,top:b?0:c[0],left:b?0:c[1],right:"",bottom:""}),e.css({width:g-i,height:h-j-k-l})},5)},b.getChildFrame=function(b,c){return c=c||a(".jeboxiframe").attr("jeitem"),a("#"+f[0]+c).find("iframe").contents().find(b)},b.getFrameIndex=function(b){return a("#"+f[0]+b).attr("jeitem")},b.iframeUrl=function(b,c){a("#"+f[0]+b).find("iframe").attr("src",c)},b});